<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ConnectEd - Master Your Knowledge</title>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      color: #1e293b;
      min-height: 100%;
    }

    html {
      height: 100%;
    }

    * {
      box-sizing: border-box;
    }

    body.dark-mode {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
    }

    /* ========================================
       SPLASH SCREEN
       ======================================== */
    
    .splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      transition: opacity 0.5s ease;
    }

    .splash-screen.hide {
      opacity: 0;
      pointer-events: none;
    }

    .splash-logo {
      font-size: 56px;
      font-weight: 900;
      color: white;
      margin-bottom: 16px;
      letter-spacing: -1px;
    }

    .splash-tagline {
      font-size: 18px;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 48px;
      font-weight: 600;
    }

    .splash-loader {
      width: 200px;
      height: 6px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }

    .splash-loader-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: white;
      border-radius: 10px;
      animation: splashLoad 2s ease-in-out;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    }

    @keyframes splashLoad {
      0% {
        width: 0%;
        transform: translateX(0);
      }
      50% {
        width: 70%;
      }
      100% {
        width: 100%;
      }
    }

    /* ========================================
       TUTORIAL OVERLAY
       ======================================== */
    
    .tutorial-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .tutorial-overlay.show {
      display: flex;
    }

    .tutorial-content {
      background: white;
      border-radius: 32px;
      padding: 48px;
      max-width: 600px;
      width: 100%;
      text-align: center;
      position: relative;
    }

    body.dark-mode .tutorial-content {
      background: #1e293b;
    }

    .tutorial-step {
      display: none;
    }

    .tutorial-step.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .tutorial-icon {
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
      font-size: 48px;
    }

    .tutorial-title {
      font-size: 28px;
      font-weight: 800;
      margin: 0 0 16px 0;
    }

    .tutorial-description {
      font-size: 16px;
      color: #64748b;
      line-height: 1.6;
      margin: 0 0 32px 0;
    }

    .tutorial-progress {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-bottom: 24px;
    }

    .tutorial-dot {
      width: 10px;
      height: 10px;
      background: #cbd5e1;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .tutorial-dot.active {
      background: #8b5cf6;
      width: 24px;
      border-radius: 5px;
    }

    .tutorial-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    /* ========================================
       MAIN APP
       ======================================== */

    .app-container {
      display: flex;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    /* Side Navigation */
    .side-nav {
      display: none;
      width: 280px;
      background: white;
      border-right: 1px solid #e2e8f0;
      flex-direction: column;
      padding: 24px 0;
      box-shadow: 2px 0 12px rgba(0, 0, 0, 0.04);
    }

    body.dark-mode .side-nav {
      background: #1e293b;
      border-right-color: #334155;
    }

    .side-nav-logo {
      padding: 0 24px 24px;
      border-bottom: 1px solid #e2e8f0;
      margin-bottom: 24px;
    }

    body.dark-mode .side-nav-logo {
      border-bottom-color: #334155;
    }

    .logo-text {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .nav-items {
      flex: 1;
      padding: 0 12px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      padding: 14px 16px;
      margin-bottom: 8px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #64748b;
      font-weight: 600;
    }

    .nav-item:hover {
      background: #f1f5f9;
      color: #475569;
    }

    body.dark-mode .nav-item:hover {
      background: #334155;
    }

    .nav-item.active {
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      color: white;
    }

    .nav-icon {
      width: 24px;
      height: 24px;
      margin-right: 12px;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      width: 100%;
    }

    .top-bar {
      display: none;
      background: white;
      padding: 16px 20px;
      border-bottom: 1px solid #e2e8f0;
      align-items: center;
      justify-content: space-between;
    }

    body.dark-mode .top-bar {
      background: #1e293b;
      border-bottom-color: #334155;
    }

    .top-bar-title {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .content-wrapper {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      padding-bottom: 24px;
    }

    @media (max-width: 767px) {
      .content-wrapper {
        padding: 16px;
        padding-bottom: 100px;
      }
    }

    /* Bottom Navigation */
    .bottom-nav {
      display: flex;
      background: white;
      border-top: 1px solid #e2e8f0;
      padding: 8px 0;
      justify-content: space-around;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }

    body.dark-mode .bottom-nav {
      background: #1e293b;
      border-top-color: #334155;
    }

    .bottom-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #64748b;
      flex: 1;
    }

    .bottom-nav-item.active {
      color: #8b5cf6;
    }

    .bottom-nav-icon {
      width: 24px;
      height: 24px;
      margin-bottom: 4px;
    }

    .bottom-nav-label {
      font-size: 11px;
      font-weight: 700;
    }

    /* Page Container */
    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    /* Welcome Section */
    .welcome-section {
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      border-radius: 24px;
      padding: 40px;
      color: white;
      margin-bottom: 32px;
      position: relative;
      overflow: hidden;
    }

    .welcome-title {
      font-size: 32px;
      font-weight: 800;
      margin: 0 0 8px 0;
      position: relative;
      z-index: 1;
    }

    .welcome-subtitle {
      font-size: 16px;
      opacity: 0.9;
      margin: 0;
      position: relative;
      z-index: 1;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: white;
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
      transition: all 0.3s ease;
    }

    body.dark-mode .stat-card {
      background: #1e293b;
    }

    .stat-card:hover {
      transform: translateY(-4px);
    }

    .stat-value {
      font-size: 32px;
      font-weight: 800;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 6px 0;
    }

    .stat-label {
      font-size: 13px;
      color: #64748b;
      margin: 0;
      font-weight: 600;
    }

    .section-title {
      font-size: 24px;
      font-weight: 700;
      margin: 0 0 20px 0;
    }

    .daily-challenge {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border-radius: 20px;
      padding: 28px;
      color: #78350f;
      margin-bottom: 40px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .daily-challenge:hover {
      transform: scale(1.02);
    }

    .challenge-badge {
      display: inline-block;
      background: rgba(255, 255, 255, 0.3);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .challenge-title {
      font-size: 22px;
      font-weight: 700;
      margin: 0 0 8px 0;
    }

    .challenge-description {
      font-size: 14px;
      margin: 0;
      opacity: 0.9;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
    }

    .action-card {
      background: white;
      border-radius: 20px;
      padding: 28px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
    }

    body.dark-mode .action-card {
      background: #1e293b;
    }

    .action-card:hover {
      transform: translateY(-6px);
    }

    .action-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }

    .action-title {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 6px 0;
    }

    .action-description {
      font-size: 13px;
      color: #64748b;
      margin: 0;
    }

    /* Match Type Cards */
    .match-types-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
    }

    .match-type-card {
      background: white;
      border-radius: 24px;
      padding: 32px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    }

    body.dark-mode .match-type-card {
      background: #1e293b;
    }

    .match-type-card:hover {
      transform: translateY(-8px);
    }

    .match-type-icon-wrapper {
      width: 72px;
      height: 72px;
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      font-size: 32px;
      font-weight: 700;
      color: #8b5cf6;
    }

    .match-type-title {
      font-size: 22px;
      font-weight: 700;
      margin: 0 0 10px 0;
    }

    .match-type-description {
      font-size: 14px;
      color: #64748b;
      margin: 0 0 20px 0;
    }

    .match-type-stats {
      font-size: 13px;
      color: #64748b;
      font-weight: 600;
    }

    /* Subject & Set Selection */
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      font-size: 14px;
      color: #64748b;
      font-weight: 600;
      flex-wrap: wrap;
    }

    .breadcrumb-item {
      cursor: pointer;
    }

    .breadcrumb-item:hover {
      color: #8b5cf6;
    }

    .subject-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
    }

    .subject-card {
      background: white;
      border-radius: 20px;
      padding: 28px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid #e2e8f0;
    }

    body.dark-mode .subject-card {
      background: #1e293b;
      border-color: #334155;
    }

    .subject-card:hover {
      transform: translateY(-6px);
      border-color: #8b5cf6;
    }

    .subject-icon {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
    }

    .subject-name {
      font-size: 20px;
      font-weight: 700;
      margin: 0 0 8px 0;
    }

    .subject-info {
      font-size: 13px;
      color: #64748b;
      margin: 0;
      font-weight: 600;
    }

    /* Set List */
    .set-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }

    @media (max-width: 767px) {
      .set-list {
        grid-template-columns: 1fr;
      }
    }

    .set-item {
      background: white;
      border-radius: 20px;
      padding: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid #e2e8f0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    body.dark-mode .set-item {
      background: #1e293b;
      border-color: #334155;
    }

    .set-item:hover {
      transform: translateY(-4px);
      border-color: #8b5cf6;
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.15);
    }

    .set-main-info {
      flex: 1;
    }

    .set-name {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 8px 0;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .difficulty-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
    }

    .difficulty-badge.beginner {
      background: #d1fae5;
      color: #065f46;
    }

    .difficulty-badge.intermediate {
      background: #fef3c7;
      color: #78350f;
    }

    .difficulty-badge.advanced {
      background: #fecaca;
      color: #7f1d1d;
    }

    .set-meta {
      font-size: 13px;
      color: #64748b;
      margin: 0;
      font-weight: 600;
    }

    .set-stats {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 16px;
    }

    /* Game Mode Selector */
    .game-mode-selector {
      background: white;
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 32px;
    }

    body.dark-mode .game-mode-selector {
      background: #1e293b;
    }

    .mode-selector-title {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 20px 0;
    }

    .mode-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
    }

    .mode-option {
      padding: 16px;
      border: 2px solid #e2e8f0;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
    }

    body.dark-mode .mode-option {
      border-color: #334155;
    }

    .mode-option:hover:not(.locked) {
      border-color: #8b5cf6;
      background: #f5f3ff;
    }

    body.dark-mode .mode-option:hover:not(.locked) {
      background: #2d1b4e;
    }

    .mode-option.active {
      border-color: #8b5cf6;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      color: white;
    }

    .mode-option.locked {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .mode-option-name {
      font-size: 15px;
      font-weight: 700;
      margin: 0 0 6px 0;
    }

    .mode-option-desc {
      font-size: 11px;
      opacity: 0.8;
      margin: 0;
    }

    .lock-icon {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 16px;
    }

    /* Game Screen */
    .game-container {
      max-width: 1100px;
      margin: 0 auto;
    }

    .game-header {
      background: white;
      border-radius: 20px;
      padding: 24px 28px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 16px;
    }

    body.dark-mode .game-header {
      background: #1e293b;
    }

    .game-title-section h2 {
      font-size: 22px;
      font-weight: 700;
      margin: 0 0 8px 0;
    }

    .game-mode-badge {
      display: inline-block;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      color: white;
      padding: 6px 14px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
    }

    .game-controls {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .timer {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      min-width: 90px;
      text-align: center;
    }

    .score-panel {
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      border-radius: 20px;
      padding: 24px 28px;
      margin-bottom: 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
      flex-wrap: wrap;
      gap: 20px;
    }

    .score-item-game {
      text-align: center;
    }

    .score-item-game .label {
      font-size: 13px;
      opacity: 0.9;
      margin: 0 0 6px 0;
      font-weight: 600;
    }

    .score-item-game .value {
      font-size: 28px;
      font-weight: 800;
      margin: 0;
    }

    .hint-btn {
      background: #fbbf24;
      color: #78350f;
      border: none;
      padding: 14px 28px;
      border-radius: 14px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .hint-btn:hover {
      background: #f59e0b;
      transform: scale(1.05);
    }

    .hint-btn:disabled {
      background: #cbd5e1;
      color: #94a3b8;
      cursor: not-allowed;
      transform: none;
    }

    .matching-area {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      margin-bottom: 32px;
    }

    @media (max-width: 767px) {
      .matching-area {
        grid-template-columns: 1fr;
        gap: 24px;
      }
    }

    .column {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .column-title {
      font-size: 18px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 12px;
    }

    .match-card {
      background: white;
      border: 3px solid #e2e8f0;
      border-radius: 16px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      min-height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      position: relative;
    }

    body.dark-mode .match-card {
      background: #1e293b;
      border-color: #334155;
    }

    .match-card:hover {
      transform: translateY(-4px);
    }

    .match-card.selected {
      border-color: #8b5cf6;
      background: #f5f3ff;
      transform: scale(1.03);
    }

    body.dark-mode .match-card.selected {
      background: #2d1b4e;
    }

    .match-card.matched {
      border-color: #10b981;
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      cursor: default;
    }

    body.dark-mode .match-card.matched {
      background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
    }

    .match-card-text {
      font-size: 16px;
      font-weight: 600;
      color: #1e293b;
      line-height: 1.5;
    }

    body.dark-mode .match-card-text {
      color: #e2e8f0;
    }

    .match-card.matched .match-card-text {
      color: #065f46;
    }

    body.dark-mode .match-card.matched .match-card-text {
      color: #a7f3d0;
    }

    .check-mark {
      position: absolute;
      top: 10px;
      right: 12px;
      width: 24px;
      height: 24px;
      opacity: 0;
      transform: scale(0);
      transition: all 0.3s ease;
    }

    .match-card.matched .check-mark {
      opacity: 1;
      transform: scale(1);
    }

    /* Game Results */
    .game-results {
      background: white;
      border-radius: 28px;
      padding: 48px;
      text-align: center;
      max-width: 650px;
      margin: 0 auto;
      display: none;
    }

    body.dark-mode .game-results {
      background: #1e293b;
    }

    .game-results.show {
      display: block;
    }

    .results-title {
      font-size: 40px;
      font-weight: 800;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 20px 0;
    }

    .results-stars {
      font-size: 56px;
      margin: 24px 0;
    }

    .results-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 24px;
      margin: 40px 0;
    }

    .result-stat {
      text-align: center;
    }

    .result-stat-value {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 8px 0;
    }

    .result-stat-label {
      font-size: 13px;
      color: #64748b;
      margin: 0;
      font-weight: 700;
    }

    .results-actions {
      display: flex;
      gap: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 16px 32px;
      border-radius: 14px;
      border: none;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: #f1f5f9;
      color: #475569;
    }

    body.dark-mode .btn-secondary {
      background: #334155;
      color: #cbd5e1;
    }

    .btn-secondary:hover {
      background: #e2e8f0;
    }

    body.dark-mode .btn-secondary:hover {
      background: #475569;
    }

    /* Profile Page */
    .profile-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .profile-header {
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      border-radius: 24px;
      padding: 40px;
      color: white;
      margin-bottom: 32px;
      display: flex;
      align-items: center;
      gap: 32px;
      flex-wrap: wrap;
    }

    .profile-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      font-weight: 800;
      color: #8b5cf6;
    }

    .profile-info {
      flex: 1;
    }

    .profile-name {
      font-size: 36px;
      font-weight: 800;
      margin: 0 0 8px 0;
    }

    .profile-level {
      font-size: 18px;
      opacity: 0.9;
      margin: 0;
    }

    .achievements-section {
      background: white;
      border-radius: 20px;
      padding: 32px;
      margin-bottom: 24px;
    }

    body.dark-mode .achievements-section {
      background: #1e293b;
    }

    .achievements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }

    .achievement-card {
      background: #f8fafc;
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      transition: all 0.3s ease;
      border: 2px solid #e2e8f0;
    }

    body.dark-mode .achievement-card {
      background: #0f172a;
      border-color: #334155;
    }

    .achievement-card.unlocked {
      border-color: #8b5cf6;
      background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
    }

    body.dark-mode .achievement-card.unlocked {
      background: linear-gradient(135deg, #2d1b4e 0%, #1e1b4b 100%);
    }

    .achievement-card.locked {
      opacity: 0.4;
    }

    .achievement-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .achievement-name {
      font-size: 16px;
      font-weight: 700;
      margin: 0 0 8px 0;
    }

    .achievement-desc {
      font-size: 12px;
      color: #64748b;
      margin: 0;
    }

    .stats-section {
      background: white;
      border-radius: 20px;
      padding: 32px;
    }

    body.dark-mode .stats-section {
      background: #1e293b;
    }

    .detailed-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
    }

    .detailed-stat {
      text-align: center;
      padding: 20px;
      background: #f8fafc;
      border-radius: 16px;
    }

    body.dark-mode .detailed-stat {
      background: #0f172a;
    }

    .detailed-stat-value {
      font-size: 32px;
      font-weight: 800;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 8px 0;
    }

    .detailed-stat-label {
      font-size: 14px;
      color: #64748b;
      margin: 0;
      font-weight: 600;
    }

    /* Create Set Page */
    .create-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .create-form {
      background: white;
      border-radius: 20px;
      padding: 32px;
    }

    body.dark-mode .create-form {
      background: #1e293b;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #475569;
    }

    body.dark-mode .form-label {
      color: #cbd5e1;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 15px;
      font-family: inherit;
      transition: all 0.2s ease;
      background: white;
      color: #1e293b;
    }

    body.dark-mode .form-input,
    body.dark-mode .form-select,
    body.dark-mode .form-textarea {
      background: #0f172a;
      border-color: #334155;
      color: #e2e8f0;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: #8b5cf6;
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .pairs-container {
      margin-top: 32px;
    }

    .pair-item {
      background: #f8fafc;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 16px;
      position: relative;
    }

    body.dark-mode .pair-item {
      background: #0f172a;
    }

    .pair-number {
      font-size: 14px;
      font-weight: 700;
      color: #8b5cf6;
      margin-bottom: 16px;
    }

    .remove-pair-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      background: #fee2e2;
      color: #dc2626;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .remove-pair-btn:hover {
      background: #fecaca;
    }

    .add-pair-btn {
      width: 100%;
      padding: 16px;
      background: #f1f5f9;
      border: 2px dashed #cbd5e1;
      border-radius: 12px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 700;
      color: #64748b;
      transition: all 0.2s ease;
    }

    body.dark-mode .add-pair-btn {
      background: #0f172a;
      border-color: #475569;
      color: #94a3b8;
    }

    .add-pair-btn:hover {
      border-color: #8b5cf6;
      color: #8b5cf6;
      background: #f5f3ff;
    }

    body.dark-mode .add-pair-btn:hover {
      background: #2d1b4e;
    }

    .form-actions {
      display: flex;
      gap: 16px;
      margin-top: 32px;
      flex-wrap: wrap;
    }

    /* Settings */
    .settings-container {
      max-width: 750px;
      margin: 0 auto;
    }

    .settings-section {
      background: white;
      border-radius: 20px;
      padding: 28px;
      margin-bottom: 24px;
    }

    body.dark-mode .settings-section {
      background: #1e293b;
    }

    .settings-section h3 {
      font-size: 20px;
      font-weight: 700;
      margin: 0 0 20px 0;
    }

    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 0;
      border-bottom: 1px solid #f1f5f9;
    }

    body.dark-mode .setting-item {
      border-bottom-color: #334155;
    }

    .setting-item:last-child {
      border-bottom: none;
    }

    .setting-info {
      flex: 1;
    }

    .setting-info h4 {
      font-size: 16px;
      font-weight: 700;
      margin: 0 0 6px 0;
    }

    .setting-info p {
      font-size: 13px;
      color: #64748b;
      margin: 0;
    }

    .toggle-switch {
      width: 56px;
      height: 30px;
      background: #cbd5e1;
      border-radius: 15px;
      position: relative;
      cursor: pointer;
      transition: background 0.3s ease;
      flex-shrink: 0;
    }

    .toggle-switch.active {
      background: #8b5cf6;
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 24px;
      height: 24px;
      background: white;
      border-radius: 50%;
      top: 3px;
      left: 3px;
      transition: transform 0.3s ease;
    }

    .toggle-switch.active::after {
      transform: translateX(26px);
    }

    .setting-button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .setting-button:hover {
      transform: scale(1.05);
    }

    /* Moon Rating */
    .moon-rating {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-bottom: 24px;
    }

    .moon {
      font-size: 36px;
      cursor: pointer;
      transition: all 0.3s ease;
      opacity: 0.3;
      filter: grayscale(100%);
    }

    .moon.active {
      opacity: 1;
      filter: grayscale(0%);
      transform: scale(1.2);
    }

    .moon:hover {
      transform: scale(1.3);
    }

    /* Info Panel */
    .info-panel {
      position: fixed;
      top: 0;
      right: -100%;
      width: 100%;
      max-width: 500px;
      height: 100%;
      background: white;
      box-shadow: -4px 0 24px rgba(0, 0, 0, 0.15);
      z-index: 9999;
      transition: right 0.4s ease;
      overflow-y: auto;
    }

    body.dark-mode .info-panel {
      background: #1e293b;
    }

    .info-panel.show {
      right: 0;
    }

    .info-panel-header {
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      color: white;
      padding: 28px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .info-panel-title {
      font-size: 24px;
      font-weight: 800;
      margin: 0;
    }

    .close-panel-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      color: white;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .close-panel-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

    .info-panel-content {
      padding: 32px;
    }

    .info-panel-content h4 {
      font-size: 20px;
      font-weight: 700;
      margin: 24px 0 12px 0;
      color: #8b5cf6;
    }

    .info-panel-content h4:first-child {
      margin-top: 0;
    }

    .info-panel-content p {
      font-size: 15px;
      line-height: 1.7;
      color: #64748b;
      margin: 0 0 16px 0;
    }

    .info-panel-content ul {
      margin: 16px 0;
      padding-left: 24px;
    }

    .info-panel-content li {
      font-size: 15px;
      line-height: 1.7;
      color: #64748b;
      margin-bottom: 8px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      z-index: 10000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 24px;
      padding: 32px;
      max-width: 450px;
      width: 100%;
      text-align: center;
    }

    body.dark-mode .modal-content {
      background: #1e293b;
    }

    .modal-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      margin: 0 0 12px 0;
    }

    .modal-message {
      font-size: 15px;
      color: #64748b;
      margin: 0 0 28px 0;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .modal-input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 15px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 700;
      letter-spacing: 2px;
    }

    body.dark-mode .modal-input {
      background: #0f172a;
      border-color: #334155;
      color: #e2e8f0;
    }

    .modal-input:focus {
      outline: none;
      border-color: #8b5cf6;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: #1e293b;
      color: white;
      padding: 18px 28px;
      border-radius: 14px;
      font-size: 15px;
      font-weight: 700;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .toast.show {
      opacity: 1;
    }

    .toast.success {
      background: #10b981;
    }

    .toast.error {
      background: #ef4444;
    }

    /* Responsive */
    @media (min-width: 768px) {
      .side-nav {
        display: flex;
      }

      .bottom-nav {
        display: none;
      }

      .top-bar {
        display: none;
      }
    }

    @media (max-width: 767px) {
      .top-bar {
        display: flex;
      }

      .profile-header {
        flex-direction: column;
        text-align: center;
      }

      .welcome-section {
        padding: 24px;
      }

      .welcome-title {
        font-size: 24px;
      }

      .tutorial-content {
        padding: 32px 24px;
      }

      .info-panel {
        max-width: 100%;
      }
    }

    @media (max-width: 480px) {
      .mode-options {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .match-types-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><!-- Splash Screen -->
  <div class="splash-screen" id="splashScreen">
   <div class="splash-logo">
    ConnectEd
   </div>
   <div class="splash-tagline">
    Master Your Knowledge
   </div>
   <div class="splash-loader">
    <div class="splash-loader-bar"></div>
   </div>
  </div><!-- Tutorial Overlay -->
  <div class="tutorial-overlay" id="tutorialOverlay">
   <div class="tutorial-content">
    <div class="tutorial-step active" data-step="1">
     <div class="tutorial-icon">
      <svg viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" width="48" height="48"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path> <circle cx="12" cy="7" r="4"></circle>
      </svg>
     </div>
     <h2 class="tutorial-title">Welcome to ConnectEd!</h2>
     <p class="tutorial-description">Master your knowledge through interactive matching games. Choose from various subjects and challenge yourself!</p>
    </div>
    <div class="tutorial-step" data-step="2">
     <div class="tutorial-icon">
      <svg viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" width="48" height="48"><circle cx="12" cy="12" r="10"></circle> <polygon points="10 8 16 12 10 16 10 8" fill="white"></polygon>
      </svg>
     </div>
     <h2 class="tutorial-title">Select Your Match Type</h2>
     <p class="tutorial-description">Choose from Vocabulary, Images, Audio, Concepts, Sequences, or Code matching. Each type offers unique challenges!</p>
    </div>
    <div class="tutorial-step" data-step="3">
     <div class="tutorial-icon">
      <svg viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" width="48" height="48"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path> <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
     </div>
     <h2 class="tutorial-title">Match &amp; Learn</h2>
     <p class="tutorial-description">Click on pairs to match terms with their definitions. Complete sets to earn points and unlock achievements!</p>
    </div>
    <div class="tutorial-step" data-step="4">
     <div class="tutorial-icon">
      <svg viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" width="48" height="48"><path d="M12 5v14M5 12h14"></path>
      </svg>
     </div>
     <h2 class="tutorial-title">Create Custom Sets</h2>
     <p class="tutorial-description">Build your own matching sets with custom terms and definitions. Share your knowledge with others!</p>
    </div>
    <div class="tutorial-progress">
     <div class="tutorial-dot active"></div>
     <div class="tutorial-dot"></div>
     <div class="tutorial-dot"></div>
     <div class="tutorial-dot"></div>
    </div>
    <div class="tutorial-actions"><button class="btn btn-secondary" id="skipTutorialBtn">Skip</button> <button class="btn btn-primary" id="nextTutorialBtn">Next</button>
    </div>
   </div>
  </div>
  <div class="app-container"><!-- Side Navigation -->
   <nav class="side-nav">
    <div class="side-nav-logo">
     <div class="logo-text">
      ConnectEd
     </div>
    </div>
    <div class="nav-items">
     <div class="nav-item active" data-page="home">
      <svg class="nav-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path> <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg> Home
     </div>
     <div class="nav-item" data-page="play">
      <svg class="nav-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle> <polygon points="10 8 16 12 10 16 10 8" fill="currentColor"></polygon>
      </svg> Play
     </div>
     <div class="nav-item" data-page="create">
      <svg class="nav-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"></path>
      </svg> Create Set
     </div>
     <div class="nav-item" data-page="profile">
      <svg class="nav-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path> <circle cx="12" cy="7" r="4"></circle>
      </svg> Profile
     </div>
     <div class="nav-item" data-page="settings">
      <svg class="nav-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle> <path d="M12 1v6m0 6v6m8.66-10l-5.2 3m-3.46 2l-5.2 3m0-12l5.2 3m3.46 2l5.2 3"></path>
      </svg> Settings
     </div>
    </div>
   </nav><!-- Main Content -->
   <main class="main-content"><!-- Top Bar (Mobile) -->
    <header class="top-bar">
     <div class="top-bar-title">
      ConnectEd
     </div>
    </header>
    <div class="content-wrapper" id="contentWrapper"><!-- HOME PAGE -->
     <div class="page active" id="homePage">
      <div class="welcome-section">
       <h1 class="welcome-title">Welcome back, <span id="usernameDisplay">Player</span>!</h1>
       <p class="welcome-subtitle">Ready to challenge your knowledge today?</p>
      </div>
      <div class="stats-grid">
       <div class="stat-card">
        <p class="stat-value" id="totalMatchesStat">0</p>
        <p class="stat-label">Total Matches</p>
       </div>
       <div class="stat-card">
        <p class="stat-value" id="winStreakStat">0</p>
        <p class="stat-label">Win Streak</p>
       </div>
       <div class="stat-card">
        <p class="stat-value" id="accuracyStat">0%</p>
        <p class="stat-label">Accuracy</p>
       </div>
       <div class="stat-card">
        <p class="stat-value" id="levelStat">1</p>
        <p class="stat-label">Level</p>
       </div>
      </div>
      <h2 class="section-title">Daily Challenge</h2>
      <div class="daily-challenge" id="dailyChallenge"><span class="challenge-badge">TODAY'S CHALLENGE</span>
       <h3 class="challenge-title">Basic Geometry Mastery</h3>
       <p class="challenge-description">Complete the Basic Geometry set in under 60 seconds!</p>
      </div>
      <h2 class="section-title">Quick Actions</h2>
      <div class="quick-actions">
       <div class="action-card" data-action="play">
        <div class="action-icon">
         <svg viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" width="24" height="24"><polygon points="5 3 19 12 5 21 5 3" fill="white"></polygon>
         </svg>
        </div>
        <h3 class="action-title">Start Playing</h3>
        <p class="action-description">Choose a match type to begin</p>
       </div>
       <div class="action-card" data-action="create">
        <div class="action-icon">
         <svg viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" width="24" height="24"><path d="M12 5v14M5 12h14"></path>
         </svg>
        </div>
        <h3 class="action-title">Create Set</h3>
        <p class="action-description">Make your own match sets</p>
       </div>
       <div class="action-card" data-action="profile">
        <div class="action-icon">
         <svg viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" width="24" height="24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path> <circle cx="12" cy="7" r="4"></circle>
         </svg>
        </div>
        <h3 class="action-title">View Profile</h3>
        <p class="action-description">Check your achievements</p>
       </div>
      </div>
     </div><!-- PLAY PAGE -->
     <div class="page" id="playPage"><!-- Match Type Selection -->
      <div id="matchTypeSelection">
       <h2 class="section-title">Choose Your Match Type</h2>
       <div class="match-types-grid" id="matchTypesGrid"></div>
      </div><!-- Subject Selection -->
      <div id="subjectSelection" style="display: none;">
       <div class="breadcrumb"><span class="breadcrumb-item" data-breadcrumb="matchTypes">Match Types</span> <span>›</span> <span id="currentMatchTypeBreadcrumb">Vocabulary Match</span>
       </div>
       <h2 class="section-title">Select a Subject</h2>
       <div class="subject-grid" id="subjectGrid"></div>
      </div><!-- Set Selection -->
      <div id="setSelection" style="display: none;">
       <div class="breadcrumb"><span class="breadcrumb-item" data-breadcrumb="matchTypes">Match Types</span> <span>›</span> <span class="breadcrumb-item" data-breadcrumb="subjects">Subjects</span> <span>›</span> <span id="currentSubjectBreadcrumb">Mathematics</span>
       </div><!-- Game Mode Selector -->
       <div class="game-mode-selector">
        <h3 class="mode-selector-title">Choose Game Mode</h3>
        <div class="mode-options" id="modeOptions"></div>
       </div>
       <h2 class="section-title">Choose a Set</h2>
       <div class="set-list" id="setList"></div>
      </div>
     </div><!-- CREATE SET PAGE -->
     <div class="page" id="createPage">
      <div class="create-container">
       <h2 class="section-title">Create Custom Set</h2>
       <div class="create-form">
        <div class="form-group"><label class="form-label" for="setName">Set Name</label> <input type="text" id="setName" class="form-input" placeholder="e.g., Spanish Vocabulary">
        </div>
        <div class="form-group"><label class="form-label" for="setSubject">Subject</label> <input type="text" id="setSubject" class="form-input" placeholder="e.g., Language">
        </div>
        <div class="form-group"><label class="form-label" for="setDifficulty">Difficulty</label> <select id="setDifficulty" class="form-select"> <option value="beginner">Beginner</option> <option value="intermediate">Intermediate</option> <option value="advanced">Advanced</option> </select>
        </div>
        <div class="pairs-container">
         <h3 class="section-title">Pairs</h3>
         <div id="pairsContainer">
          <div class="pair-item" data-pair-index="0">
           <div class="pair-number">
            Pair 1
           </div>
           <div class="form-group"><label class="form-label">Term</label> <input type="text" class="form-input pair-term" placeholder="Enter term">
           </div>
           <div class="form-group"><label class="form-label">Definition</label> <input type="text" class="form-input pair-definition" placeholder="Enter definition">
           </div>
          </div>
         </div><button class="add-pair-btn" id="addPairBtn">+ Add Another Pair</button>
        </div>
        <div class="form-actions"><button class="btn btn-primary" id="saveSetBtn">Save Set</button> <button class="btn btn-secondary" id="cancelCreateBtn">Cancel</button>
        </div>
       </div>
      </div>
     </div><!-- PROFILE PAGE -->
     <div class="page" id="profilePage">
      <div class="profile-container">
       <div class="profile-header">
        <div class="profile-avatar" id="profileAvatar">
         P
        </div>
        <div class="profile-info">
         <h1 class="profile-name" id="profileName">Player</h1>
         <p class="profile-level">Level <span id="profileLevel">1</span> Master</p>
        </div>
       </div>
       <h2 class="section-title">Achievements</h2>
       <div class="achievements-section">
        <div class="achievements-grid" id="achievementsGrid"></div>
       </div>
       <h2 class="section-title">Detailed Statistics</h2>
       <div class="stats-section">
        <div class="detailed-stats-grid">
         <div class="detailed-stat">
          <p class="detailed-stat-value" id="totalGamesPlayed">0</p>
          <p class="detailed-stat-label">Games Played</p>
         </div>
         <div class="detailed-stat">
          <p class="detailed-stat-value" id="totalScore">0</p>
          <p class="detailed-stat-label">Total Score</p>
         </div>
         <div class="detailed-stat">
          <p class="detailed-stat-value" id="avgAccuracy">0%</p>
          <p class="detailed-stat-label">Avg Accuracy</p>
         </div>
         <div class="detailed-stat">
          <p class="detailed-stat-value" id="fastestTime">--</p>
          <p class="detailed-stat-label">Fastest Time</p>
         </div>
         <div class="detailed-stat">
          <p class="detailed-stat-value" id="perfectGames">0</p>
          <p class="detailed-stat-label">Perfect Games</p>
         </div>
         <div class="detailed-stat">
          <p class="detailed-stat-value" id="customSetsCreated">0</p>
          <p class="detailed-stat-label">Sets Created</p>
         </div>
        </div>
       </div>
      </div>
     </div><!-- GAME PAGE -->
     <div class="page" id="gamePage">
      <div class="game-container">
       <div class="game-header">
        <div class="game-title-section">
         <h2 id="gameSetName">Basic Geometry</h2><span class="game-mode-badge" id="gameModeBadge">Classic Mode</span>
        </div>
        <div class="game-controls">
         <div class="timer" id="gameTimer">
          00:00
         </div>
        </div>
       </div>
       <div class="score-panel">
        <div class="score-item-game">
         <p class="label">Matches</p>
         <p class="value"><span id="matchesCount">0</span>/<span id="totalPairs">6</span></p>
        </div><button class="hint-btn" id="hintBtn">Show Hint</button>
        <div class="score-item-game">
         <p class="label">Hints Used</p>
         <p class="value" id="hintsUsed">0</p>
        </div>
       </div>
       <div class="matching-area" id="matchingArea">
        <div class="column">
         <div class="column-title">
          Terms
         </div>
         <div id="termsColumn"></div>
        </div>
        <div class="column">
         <div class="column-title">
          Definitions
         </div>
         <div id="definitionsColumn"></div>
        </div>
       </div>
       <div class="game-results" id="gameResults">
        <h2 class="results-title" id="resultsTitle">Excellent Work!</h2>
        <div class="results-stars" id="resultsStars"></div>
        <div class="results-stats" id="resultsStatsContainer">
         <div class="result-stat">
          <p class="result-stat-value" id="resultTime">45s</p>
          <p class="result-stat-label">Time</p>
         </div>
         <div class="result-stat">
          <p class="result-stat-value" id="resultAccuracy">100%</p>
          <p class="result-stat-label">Accuracy</p>
         </div>
         <div class="result-stat">
          <p class="result-stat-value" id="resultScore">300</p>
          <p class="result-stat-label">Score</p>
         </div>
        </div>
        <div class="results-actions"><button class="btn btn-primary" id="playAgainBtn">Play Again</button> <button class="btn btn-secondary" id="backToSetsBtn">Back to Sets</button>
        </div>
       </div>
      </div>
     </div><!-- SETTINGS PAGE -->
     <div class="page" id="settingsPage">
      <h2 class="section-title">Settings</h2>
      <div class="settings-container">
       <div class="settings-section">
        <h3>Preferences</h3>
        <div class="setting-item">
         <div class="setting-info">
          <h4>Dark Mode</h4>
          <p>Toggle dark theme</p>
         </div>
         <div class="toggle-switch" id="darkModeToggle"></div>
        </div>
       </div>
       <div class="settings-section">
        <h3>Account</h3>
        <div class="setting-item">
         <div class="setting-info">
          <h4>Username</h4>
          <p id="currentUsername">Player</p>
         </div><button class="btn btn-secondary" id="changeUsernameBtn">Change</button>
        </div>
        <div class="setting-item">
         <div class="setting-info">
          <h4>Master Key</h4>
          <p>Unlock all premium content</p>
         </div><button class="btn btn-secondary" id="addMasterKeyBtn">Add Key</button>
        </div>
       </div>
       <div class="settings-section">
        <h3>Information</h3>
        <div class="setting-item">
         <div class="setting-info">
          <h4>About App</h4>
          <p>Learn more about ConnectEd</p>
         </div><button class="setting-button" data-info="about">View</button>
        </div>
        <div class="setting-item">
         <div class="setting-info">
          <h4>How to Use</h4>
          <p>Quick guide and tutorial</p>
         </div><button class="setting-button" data-info="howto">View</button>
        </div>
        <div class="setting-item">
         <div class="setting-info">
          <h4>Privacy Policy</h4>
          <p>Your data and privacy</p>
         </div><button class="setting-button" data-info="privacy">View</button>
        </div>
       </div>
       <div class="settings-section">
        <h3>Feedback</h3>
        <div class="setting-item">
         <div class="setting-info">
          <h4>Submit Feedback</h4>
          <p>Rate and share your experience</p>
         </div><button class="setting-button" id="submitFeedbackBtn">Submit</button>
        </div>
       </div>
      </div>
     </div>
    </div><!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
     <div class="bottom-nav-item active" data-page="home">
      <svg class="bottom-nav-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path> <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg><span class="bottom-nav-label">Home</span>
     </div>
     <div class="bottom-nav-item" data-page="play">
      <svg class="bottom-nav-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle> <polygon points="10 8 16 12 10 16 10 8" fill="currentColor"></polygon>
      </svg><span class="bottom-nav-label">Play</span>
     </div>
     <div class="bottom-nav-item" data-page="create">
      <svg class="bottom-nav-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"></path>
      </svg><span class="bottom-nav-label">Create</span>
     </div>
     <div class="bottom-nav-item" data-page="profile">
      <svg class="bottom-nav-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path> <circle cx="12" cy="7" r="4"></circle>
      </svg><span class="bottom-nav-label">Profile</span>
     </div>
     <div class="bottom-nav-item" data-page="settings">
      <svg class="bottom-nav-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle> <path d="M12 1v6m0 6v6m8.66-10l-5.2 3m-3.46 2l-5.2 3m0-12l5.2 3m3.46 2l5.2 3"></path>
      </svg><span class="bottom-nav-label">Settings</span>
     </div>
    </nav>
   </main>
  </div><!-- Info Panel -->
  <div class="info-panel" id="infoPanel">
   <div class="info-panel-header">
    <h3 class="info-panel-title" id="infoPanelTitle">About App</h3><button class="close-panel-btn" id="closePanelBtn">×</button>
   </div>
   <div class="info-panel-content" id="infoPanelContent"></div>
  </div><!-- Unlock Modal -->
  <div class="modal" id="unlockModal">
   <div class="modal-content">
    <div class="modal-icon">
     🔒
    </div>
    <h3 class="modal-title">Mode Locked</h3>
    <p class="modal-message" id="unlockMessage">Complete 5 more games or enter the master key to unlock this mode.</p><input type="text" class="modal-input" id="masterKeyInput" placeholder="Enter Master Key">
    <div class="modal-actions"><button class="btn btn-primary" id="unlockBtn">Unlock</button> <button class="btn btn-secondary" id="cancelUnlockBtn">Cancel</button>
    </div>
   </div>
  </div><!-- Username Modal -->
  <div class="modal" id="usernameModal">
   <div class="modal-content">
    <div class="modal-icon">
     👤
    </div>
    <h3 class="modal-title">Change Username</h3><input type="text" class="modal-input" id="usernameInput" placeholder="Enter new username">
    <div class="modal-actions"><button class="btn btn-primary" id="saveUsernameBtn">Save</button> <button class="btn btn-secondary" id="cancelUsernameBtn">Cancel</button>
    </div>
   </div>
  </div><!-- Master Key Modal -->
  <div class="modal" id="masterKeyModal">
   <div class="modal-content">
    <div class="modal-icon">
     🔑
    </div>
    <h3 class="modal-title">Enter Master Key</h3>
    <p class="modal-message">Enter the master key to unlock all premium content</p><input type="text" class="modal-input" id="masterKeySettingsInput" placeholder="Enter Master Key">
    <div class="modal-actions"><button class="btn btn-primary" id="saveMasterKeyBtn">Activate</button> <button class="btn btn-secondary" id="cancelMasterKeyBtn">Cancel</button>
    </div>
   </div>
  </div><!-- Feedback Modal -->
  <div class="modal" id="feedbackModal">
   <div class="modal-content">
    <div class="modal-icon">
     💬
    </div>
    <h3 class="modal-title">Submit Feedback</h3>
    <p style="margin: 0 0 16px 0; font-size: 15px; color: #64748b;">Rate ConnectEd</p>
    <div class="moon-rating" id="moonRating"><span class="moon" data-rating="1">🌑</span> <span class="moon" data-rating="2">🌑</span> <span class="moon" data-rating="3">🌑</span> <span class="moon" data-rating="4">🌑</span> <span class="moon" data-rating="5">🌑</span> <span class="moon" data-rating="6">🌑</span> <span class="moon" data-rating="7">🌑</span>
    </div><textarea class="form-textarea" id="feedbackText" placeholder="Share your thoughts..." style="margin-bottom: 20px;"></textarea>
    <div class="modal-actions"><button class="btn btn-primary" id="sendFeedbackBtn">Send</button> <button class="btn btn-secondary" id="cancelFeedbackBtn">Cancel</button>
    </div>
   </div>
  </div><!-- Toast Notification -->
  <div class="toast" id="toast"></div>
  <script>
    // ========================================
    // GLOBAL STATE
    // ========================================
    
    const MASTER_KEY = 'Sisco7';
    
    let allGameData = [];
    let customSets = [];
    let userAchievements = [];
    let unlockedModes = ['classic', 'speed'];
    let currentUsername = 'Player';
    let selectedMatchType = '';
    let selectedSubject = '';
    let selectedSet = null;
    let selectedMode = 'classic';
    let selectedModeForUnlock = null;
    let currentTutorialStep = 1;
    let feedbackRating = 0;
    let hasMasterKey = false;
    
    // Game state
    let gameState = {
      selectedTerm: null,
      selectedDefinition: null,
      matchedPairs: [],
      wrongAttempts: 0,
      hintsUsed: 0,
      startTime: null,
      timerInterval: null,
      timeElapsed: 0,
      strikes: 0
    };

    // Settings
    let settings = {
      darkMode: false
    };

    // Achievements
    const ACHIEVEMENTS = [
      { id: 'first_win', name: 'First Victory', description: 'Complete your first match', icon: '🏆', unlocked: false },
      { id: 'speed_demon', name: 'Speed Demon', description: 'Complete a match in under 30 seconds', icon: '⚡', unlocked: false },
      { id: 'perfect_game', name: 'Perfect Game', description: 'Complete a match with 100% accuracy', icon: '💎', unlocked: false },
      { id: 'no_hints', name: 'Master Mind', description: 'Complete a match without using hints', icon: '🧠', unlocked: false },
      { id: 'ten_games', name: 'Dedicated Learner', description: 'Complete 10 matches', icon: '📚', unlocked: false },
      { id: 'all_subjects', name: 'Subject Master', description: 'Play all subject types', icon: '🌟', unlocked: false },
      { id: 'custom_creator', name: 'Set Creator', description: 'Create your first custom set', icon: '✨', unlocked: false },
      { id: 'hundred_points', name: 'Century Club', description: 'Score over 100 points in one game', icon: '💯', unlocked: false }
    ];

    // Game Modes
    const GAME_MODES = [
      { id: 'classic', name: 'Classic', description: 'No time limit', locked: false, requiredGames: 0 },
      { id: 'speed', name: 'Speed Run', description: 'Beat 60 seconds', locked: false, requiredGames: 0 },
      { id: 'time_attack', name: 'Time Attack', description: 'Race against 45 seconds', locked: true, requiredGames: 5 },
      { id: 'elimination', name: 'Elimination', description: 'Three strikes and out', locked: true, requiredGames: 10 },
      { id: 'boss_rush', name: 'Boss Rush', description: 'Complete 3 sets in a row', locked: true, requiredGames: 15 },
      { id: 'zen', name: 'Zen Mode', description: 'Relaxed, no pressure', locked: true, requiredGames: 20 }
    ];

    // Match type data
    const MATCH_TYPES = {
      vocabulary: {
        name: 'Vocabulary Match',
        icon: 'Aa',
        subjects: {
          'Mathematics': [
            {
              id: 'vocab-math-1',
              name: 'Basic Geometry',
              difficulty: 'beginner',
              pairs: [
                { term: 'Triangle', definition: 'A polygon with three sides and three angles' },
                { term: 'Circle', definition: 'A round shape where all points are equidistant from center' },
                { term: 'Rectangle', definition: 'A quadrilateral with four right angles' },
                { term: 'Radius', definition: 'Distance from center to edge of a circle' },
                { term: 'Diameter', definition: 'Distance across a circle through its center' },
                { term: 'Perimeter', definition: 'Total distance around the outside of a shape' }
              ]
            },
            {
              id: 'vocab-math-2',
              name: 'Algebra Terms',
              difficulty: 'intermediate',
              pairs: [
                { term: 'Variable', definition: 'A symbol representing an unknown value' },
                { term: 'Coefficient', definition: 'A number multiplying a variable' },
                { term: 'Constant', definition: 'A fixed value that does not change' },
                { term: 'Equation', definition: 'Mathematical statement showing two expressions are equal' },
                { term: 'Expression', definition: 'Combination of numbers, variables, and operations' },
                { term: 'Polynomial', definition: 'Sum of terms with variables raised to powers' }
              ]
            },
            {
              id: 'vocab-math-3',
              name: 'Calculus Basics',
              difficulty: 'advanced',
              pairs: [
                { term: 'Derivative', definition: 'Rate of change of a function' },
                { term: 'Integral', definition: 'Area under a curve' },
                { term: 'Limit', definition: 'Value a function approaches' },
                { term: 'Tangent', definition: 'Line touching curve at one point' },
                { term: 'Slope', definition: 'Steepness of a line' },
                { term: 'Asymptote', definition: 'Line a curve approaches but never touches' }
              ]
            }
          ],
          'Science': [
            {
              id: 'vocab-sci-1',
              name: 'Chemistry Basics',
              difficulty: 'beginner',
              pairs: [
                { term: 'Atom', definition: 'Smallest unit of a chemical element' },
                { term: 'Molecule', definition: 'Group of atoms bonded together' },
                { term: 'Element', definition: 'Pure substance made of one type of atom' },
                { term: 'Compound', definition: 'Substance made from two or more elements' },
                { term: 'Mixture', definition: 'Combination of substances not chemically bonded' },
                { term: 'Solution', definition: 'Homogeneous mixture of solute and solvent' }
              ]
            },
            {
              id: 'vocab-sci-2',
              name: 'Physics Terms',
              difficulty: 'intermediate',
              pairs: [
                { term: 'Velocity', definition: 'Speed with direction' },
                { term: 'Acceleration', definition: 'Rate of change of velocity' },
                { term: 'Force', definition: 'Push or pull on an object' },
                { term: 'Energy', definition: 'Ability to do work' },
                { term: 'Momentum', definition: 'Mass times velocity' },
                { term: 'Friction', definition: 'Resistance to motion' }
              ]
            },
            {
              id: 'vocab-sci-3',
              name: 'Biology Essentials',
              difficulty: 'beginner',
              pairs: [
                { term: 'Cell', definition: 'Basic unit of life' },
                { term: 'DNA', definition: 'Genetic material' },
                { term: 'Photosynthesis', definition: 'Plants making food from sunlight' },
                { term: 'Mitosis', definition: 'Cell division' },
                { term: 'Enzyme', definition: 'Protein that speeds reactions' },
                { term: 'Chromosome', definition: 'Structure containing DNA' }
              ]
            }
          ],
          'Language': [
            {
              id: 'vocab-lang-1',
              name: 'Spanish Basics',
              difficulty: 'beginner',
              pairs: [
                { term: 'Hola', definition: 'Hello' },
                { term: 'Gracias', definition: 'Thank you' },
                { term: 'Adiós', definition: 'Goodbye' },
                { term: 'Por favor', definition: 'Please' },
                { term: 'Sí', definition: 'Yes' },
                { term: 'No', definition: 'No' }
              ]
            },
            {
              id: 'vocab-lang-2',
              name: 'French Essentials',
              difficulty: 'beginner',
              pairs: [
                { term: 'Bonjour', definition: 'Good day/Hello' },
                { term: 'Merci', definition: 'Thank you' },
                { term: 'Au revoir', definition: 'Goodbye' },
                { term: 'Oui', definition: 'Yes' },
                { term: 'Non', definition: 'No' },
                { term: "S'il vous plaît", definition: 'Please' }
              ]
            }
          ]
        }
      },
      image: {
        name: 'Image Match',
        icon: '🖼',
        subjects: {
          'Animals': [
            {
              id: 'img-animals-1',
              name: 'Safari Animals',
              difficulty: 'beginner',
              pairs: [
                { term: '🦁', definition: 'Lion - King of the jungle' },
                { term: '🐘', definition: 'Elephant - Largest land animal' },
                { term: '🦒', definition: 'Giraffe - Tallest animal' },
                { term: '🦓', definition: 'Zebra - Striped horse-like animal' },
                { term: '🦏', definition: 'Rhinoceros - Has a horn on its nose' },
                { term: '🦛', definition: 'Hippopotamus - Lives in rivers' }
              ]
            },
            {
              id: 'img-animals-2',
              name: 'Ocean Life',
              difficulty: 'beginner',
              pairs: [
                { term: '🐋', definition: 'Whale - Largest marine mammal' },
                { term: '🦈', definition: 'Shark - Predator with sharp teeth' },
                { term: '🐬', definition: 'Dolphin - Intelligent marine mammal' },
                { term: '🐙', definition: 'Octopus - Eight-armed mollusk' },
                { term: '🦀', definition: 'Crab - Crustacean with claws' },
                { term: '🐢', definition: 'Turtle - Reptile with shell' }
              ]
            }
          ],
          'Food': [
            {
              id: 'img-food-1',
              name: 'Fruits',
              difficulty: 'beginner',
              pairs: [
                { term: '🍎', definition: 'Apple - Red and crunchy' },
                { term: '🍌', definition: 'Banana - Yellow and curved' },
                { term: '🍊', definition: 'Orange - Citrus fruit' },
                { term: '🍇', definition: 'Grapes - Small and in bunches' },
                { term: '🍓', definition: 'Strawberry - Red with seeds outside' },
                { term: '🍉', definition: 'Watermelon - Large and green outside' }
              ]
            },
            {
              id: 'img-food-2',
              name: 'Vegetables',
              difficulty: 'beginner',
              pairs: [
                { term: '🥕', definition: 'Carrot - Orange root vegetable' },
                { term: '🥦', definition: 'Broccoli - Green tree-like vegetable' },
                { term: '🌽', definition: 'Corn - Yellow kernels on cob' },
                { term: '🍅', definition: 'Tomato - Red and juicy' },
                { term: '🥔', definition: 'Potato - Starchy tuber' },
                { term: '🫑', definition: 'Bell Pepper - Sweet pepper' }
              ]
            }
          ],
          'Flags': [
            {
              id: 'img-flags-1',
              name: 'World Flags',
              difficulty: 'intermediate',
              pairs: [
                { term: '🇺🇸', definition: 'United States - Stars and stripes' },
                { term: '🇬🇧', definition: 'United Kingdom - Union Jack' },
                { term: '🇫🇷', definition: 'France - Blue, white, red' },
                { term: '🇯🇵', definition: 'Japan - Red circle on white' },
                { term: '🇨🇦', definition: 'Canada - Red maple leaf' },
                { term: '🇩🇪', definition: 'Germany - Black, red, gold' }
              ]
            }
          ]
        }
      },
      audio: {
        name: 'Audio Match',
        icon: '♪',
        subjects: {
          'Music': [
            {
              id: 'audio-music-1',
              name: 'Instruments',
              difficulty: 'beginner',
              pairs: [
                { term: '🎸 Guitar', definition: 'Stringed instrument with frets' },
                { term: '🎹 Piano', definition: 'Keyboard instrument with 88 keys' },
                { term: '🥁 Drums', definition: 'Percussion instrument' },
                { term: '🎺 Trumpet', definition: 'Brass instrument with valves' },
                { term: '🎻 Violin', definition: 'Small stringed instrument played with bow' },
                { term: '🎷 Saxophone', definition: 'Woodwind instrument made of brass' }
              ]
            }
          ]
        }
      },
      concept: {
        name: 'Concept Match',
        icon: '💡',
        subjects: {
          'History': [
            {
              id: 'concept-history-1',
              name: 'Ancient Civilizations',
              difficulty: 'intermediate',
              pairs: [
                { term: 'Egyptian Pyramids', definition: 'Massive stone structures built as tombs for pharaohs' },
                { term: 'Roman Colosseum', definition: 'Ancient amphitheater for gladiator contests' },
                { term: 'Great Wall of China', definition: 'Defensive fortification across northern China' },
                { term: 'Stonehenge', definition: 'Prehistoric monument in England' },
                { term: 'Machu Picchu', definition: 'Incan citadel in the Andes Mountains' },
                { term: 'Parthenon', definition: 'Ancient Greek temple dedicated to Athena' }
              ]
            },
            {
              id: 'concept-history-2',
              name: 'World War II',
              difficulty: 'advanced',
              pairs: [
                { term: 'D-Day', definition: 'Allied invasion of Normandy in 1944' },
                { term: 'Pearl Harbor', definition: 'Japanese attack on US naval base' },
                { term: 'Manhattan Project', definition: 'Secret program to develop atomic bomb' },
                { term: 'Battle of Stalingrad', definition: 'Major Soviet victory over Germany' },
                { term: 'Holocaust', definition: 'Systematic genocide of Jews by Nazis' },
                { term: 'VE Day', definition: 'Victory in Europe Day, May 8, 1945' }
              ]
            }
          ],
          'Literature': [
            {
              id: 'concept-lit-1',
              name: 'Literary Devices',
              difficulty: 'advanced',
              pairs: [
                { term: 'Metaphor', definition: 'Comparison without using like or as' },
                { term: 'Simile', definition: 'Comparison using like or as' },
                { term: 'Personification', definition: 'Giving human qualities to non-human things' },
                { term: 'Alliteration', definition: 'Repetition of initial consonant sounds' },
                { term: 'Hyperbole', definition: 'Exaggerated statements not meant literally' },
                { term: 'Onomatopoeia', definition: 'Words that imitate sounds' }
              ]
            }
          ]
        }
      },
      sequence: {
        name: 'Sequence Match',
        icon: '1→',
        subjects: {
          'Math': [
            {
              id: 'seq-math-1',
              name: 'Number Patterns',
              difficulty: 'intermediate',
              pairs: [
                { term: '2, 4, 6, 8...', definition: 'Even numbers' },
                { term: '1, 3, 5, 7...', definition: 'Odd numbers' },
                { term: '1, 1, 2, 3, 5...', definition: 'Fibonacci sequence' },
                { term: '1, 4, 9, 16...', definition: 'Perfect squares' },
                { term: '2, 3, 5, 7...', definition: 'Prime numbers' },
                { term: '10, 20, 30...', definition: 'Multiples of 10' }
              ]
            }
          ]
        }
      },
      code: {
        name: 'Code Match',
        icon: '</>',
        subjects: {
          'Programming': [
            {
              id: 'code-prog-1',
              name: 'JavaScript Basics',
              difficulty: 'intermediate',
              pairs: [
                { term: 'let', definition: 'Declares a block-scoped variable' },
                { term: 'const', definition: 'Declares a constant value' },
                { term: 'function', definition: 'Declares a reusable code block' },
                { term: 'return', definition: 'Exits function and returns value' },
                { term: 'if', definition: 'Conditional statement' },
                { term: 'for', definition: 'Loop statement' }
              ]
            }
          ]
        }
      }
    };

    // ========================================
    // DATA SDK
    // ========================================

    const dataHandler = {
      onDataChanged(data) {
        allGameData = data.filter(item => item.type === 'game');
        customSets = data.filter(item => item.type === 'custom_set');
        
        const userData = data.find(item => item.type === 'user_data');
        if (userData) {
          userAchievements = userData.achievements || [];
          unlockedModes = userData.unlocked_modes || ['classic', 'speed'];
          currentUsername = userData.username || 'Player';
          hasMasterKey = userData.has_master_key || false;
        }
        
        updateAllStats();
        updateProfilePage();
        checkAchievements();
      }
    };

    async function initializeApp() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize Data SDK');
        }
      }

      // Show splash screen
      setTimeout(() => {
        document.getElementById('splashScreen').classList.add('hide');
        
        // Check if first visit
        const hasSeenTutorial = localStorage.getItem('hasSeenTutorial');
        if (!hasSeenTutorial) {
          setTimeout(() => {
            document.getElementById('tutorialOverlay').classList.add('show');
          }, 500);
        }
      }, 2500);

      loadSettings();
      loadUsername();
      loadMasterKey();
      renderMatchTypes();
      renderGameModes();
      renderAchievements();
      initializeEventListeners();
      updateAllStats();
    }

    // ========================================
    // EVENT LISTENERS
    // ========================================

    function initializeEventListeners() {
      // Navigation
      document.querySelectorAll('.nav-item, .bottom-nav-item').forEach(item => {
        item.addEventListener('click', () => {
          const page = item.dataset.page;
          navigateToPage(page);
        });
      });

      // Quick actions
      document.querySelectorAll('.action-card').forEach(card => {
        card.addEventListener('click', () => {
          const action = card.dataset.action;
          navigateToPage(action);
        });
      });

      // Daily challenge
      document.getElementById('dailyChallenge').addEventListener('click', () => {
        navigateToPage('play');
      });

      // Breadcrumbs
      document.querySelectorAll('[data-breadcrumb="matchTypes"]').forEach(item => {
        item.addEventListener('click', showMatchTypeSelection);
      });

      document.querySelectorAll('[data-breadcrumb="subjects"]').forEach(item => {
        item.addEventListener('click', () => {
          showSubjectSelection(selectedMatchType);
        });
      });

      // Game controls
      document.getElementById('hintBtn').addEventListener('click', showHint);
      document.getElementById('playAgainBtn').addEventListener('click', () => {
        initializeGame();
      });
      document.getElementById('backToSetsBtn').addEventListener('click', () => {
        showSetSelection(selectedSubject);
      });

      // Create set
      document.getElementById('addPairBtn').addEventListener('click', addPairField);
      document.getElementById('saveSetBtn').addEventListener('click', saveCustomSet);
      document.getElementById('cancelCreateBtn').addEventListener('click', () => {
        navigateToPage('home');
      });

      // Settings
      document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
      document.getElementById('changeUsernameBtn').addEventListener('click', () => {
        document.getElementById('usernameModal').classList.add('show');
      });
      document.getElementById('addMasterKeyBtn').addEventListener('click', () => {
        document.getElementById('masterKeyModal').classList.add('show');
      });

      // Info buttons
      document.querySelectorAll('[data-info]').forEach(btn => {
        btn.addEventListener('click', () => {
          showInfoPanel(btn.dataset.info);
        });
      });

      document.getElementById('closePanelBtn').addEventListener('click', () => {
        document.getElementById('infoPanel').classList.remove('show');
      });

      // Feedback
      document.getElementById('submitFeedbackBtn').addEventListener('click', () => {
        feedbackRating = 0;
        document.getElementById('feedbackText').value = '';
        document.querySelectorAll('.moon').forEach(moon => {
          moon.classList.remove('active');
          moon.textContent = '🌑';
        });
        document.getElementById('feedbackModal').classList.add('show');
      });

      document.querySelectorAll('.moon').forEach(moon => {
        moon.addEventListener('click', () => {
          const rating = parseInt(moon.dataset.rating);
          feedbackRating = rating;
          
          document.querySelectorAll('.moon').forEach((m, index) => {
            if (index < rating) {
              m.classList.add('active');
              m.textContent = '🌕';
            } else {
              m.classList.remove('active');
              m.textContent = '🌑';
            }
          });
        });
      });

      document.getElementById('sendFeedbackBtn').addEventListener('click', sendFeedback);
      document.getElementById('cancelFeedbackBtn').addEventListener('click', () => {
        document.getElementById('feedbackModal').classList.remove('show');
      });

      // Tutorial
      document.getElementById('nextTutorialBtn').addEventListener('click', nextTutorialStep);
      document.getElementById('skipTutorialBtn').addEventListener('click', skipTutorial);

      // Modals
      document.getElementById('cancelUnlockBtn').addEventListener('click', () => {
        document.getElementById('unlockModal').classList.remove('show');
      });
      document.getElementById('unlockBtn').addEventListener('click', handleUnlock);
      
      document.getElementById('cancelUsernameBtn').addEventListener('click', () => {
        document.getElementById('usernameModal').classList.remove('show');
      });
      document.getElementById('saveUsernameBtn').addEventListener('click', saveUsername);

      document.getElementById('cancelMasterKeyBtn').addEventListener('click', () => {
        document.getElementById('masterKeyModal').classList.remove('show');
      });
      document.getElementById('saveMasterKeyBtn').addEventListener('click', saveMasterKey);
    }

    // ========================================
    // TUTORIAL
    // ========================================

    function nextTutorialStep() {
      const steps = document.querySelectorAll('.tutorial-step');
      const dots = document.querySelectorAll('.tutorial-dot');
      
      if (currentTutorialStep < 4) {
        steps[currentTutorialStep - 1].classList.remove('active');
        dots[currentTutorialStep - 1].classList.remove('active');
        
        currentTutorialStep++;
        
        steps[currentTutorialStep - 1].classList.add('active');
        dots[currentTutorialStep - 1].classList.add('active');
        
        if (currentTutorialStep === 4) {
          document.getElementById('nextTutorialBtn').textContent = 'Get Started';
        }
      } else {
        skipTutorial();
      }
    }

    function skipTutorial() {
      document.getElementById('tutorialOverlay').classList.remove('show');
      localStorage.setItem('hasSeenTutorial', 'true');
      currentTutorialStep = 1;
    }

    // ========================================
    // INFO PANEL
    // ========================================

    function showInfoPanel(type) {
      const panel = document.getElementById('infoPanel');
      const title = document.getElementById('infoPanelTitle');
      const content = document.getElementById('infoPanelContent');

      if (type === 'about') {
        title.textContent = 'About ConnectEd';
        content.innerHTML = `
          <h4>What is ConnectEd?</h4>
          <p>ConnectEd is an innovative educational platform designed to help students master their knowledge through interactive matching games. Our approach combines learning with engagement, making education both effective and enjoyable.</p>
          
          <h4>Features</h4>
          <ul>
            <li>6 unique match types: Vocabulary, Images, Audio, Concepts, Sequences, and Code</li>
            <li>Multiple game modes with varying difficulty levels</li>
            <li>Custom set creation for personalized learning</li>
            <li>Achievement system to track your progress</li>
            <li>Detailed statistics and performance tracking</li>
            <li>Responsive design that works on all devices</li>
          </ul>
          
          <h4>Built By</h4>
          <p>ConnectEd was created by <strong>Sisq</strong>, a passionate developer dedicated to making education accessible and engaging for everyone.</p>
          <p>Visit: <a href="https://sisco-ask.vercel.app" target="_blank" rel="noopener noreferrer" style="color: #8b5cf6; font-weight: 700;">sisco-ask.vercel.app</a></p>
          
          <h4>Version</h4>
          <p>ConnectEd v2.0 - Master Your Knowledge</p>
        `;
      } else if (type === 'howto') {
        title.textContent = 'How to Use ConnectEd';
        content.innerHTML = `
          <h4>Getting Started</h4>
          <p>ConnectEd is easy to use! Follow these simple steps to begin your learning journey:</p>
          
          <h4>1. Choose a Match Type</h4>
          <p>Select from 6 different match types based on what you want to learn: Vocabulary, Images, Audio, Concepts, Sequences, or Code.</p>
          
          <h4>2. Select a Subject</h4>
          <p>Browse through various subjects within your chosen match type. Each subject contains multiple sets covering different topics.</p>
          
          <h4>3. Pick a Game Mode</h4>
          <p>Choose how you want to play:</p>
          <ul>
            <li><strong>Classic:</strong> No time limit, perfect for beginners</li>
            <li><strong>Speed Run:</strong> Complete in under 60 seconds</li>
            <li><strong>Time Attack:</strong> Race against 45 seconds</li>
            <li><strong>Elimination:</strong> Three strikes and you're out</li>
            <li><strong>Boss Rush:</strong> Complete 3 sets in a row</li>
            <li><strong>Zen Mode:</strong> Relaxed learning with no pressure</li>
          </ul>
          
          <h4>4. Play & Learn</h4>
          <p>Click on terms and their matching definitions. Complete all pairs to finish the set and earn points!</p>
          
          <h4>5. Track Progress</h4>
          <p>View your statistics, unlock achievements, and see how much you've improved over time.</p>
          
          <h4>Pro Tips</h4>
          <ul>
            <li>Use hints wisely - you only get 3 per game</li>
            <li>Complete games without hints to unlock the Master Mind achievement</li>
            <li>Create custom sets to study your own material</li>
            <li>Try different game modes to challenge yourself</li>
          </ul>
        `;
      } else if (type === 'privacy') {
        title.textContent = 'Privacy Policy';
        content.innerHTML = `
          <h4>Your Privacy Matters</h4>
          <p>At ConnectEd, we take your privacy seriously. This policy explains how we handle your data.</p>
          
          <h4>Data We Collect</h4>
          <p>ConnectEd stores the following information locally on your device:</p>
          <ul>
            <li>Your username and profile preferences</li>
            <li>Game statistics and progress</li>
            <li>Custom sets you create</li>
            <li>Achievement unlock status</li>
            <li>App settings (dark mode, etc.)</li>
          </ul>
          
          <h4>How We Use Your Data</h4>
          <p>Your data is used exclusively to:</p>
          <ul>
            <li>Provide personalized learning experiences</li>
            <li>Track your progress and achievements</li>
            <li>Maintain your custom content</li>
            <li>Remember your preferences</li>
          </ul>
          
          <h4>Data Storage</h4>
          <p>All your data is stored locally in your browser using modern web technologies. We do not transmit your personal information to external servers.</p>
          
          <h4>Data Security</h4>
          <p>Your data remains on your device and is protected by your browser's security features. Only you have access to your ConnectEd data.</p>
          
          <h4>Your Rights</h4>
          <p>You have complete control over your data:</p>
          <ul>
            <li>View all your stored data in your Profile</li>
            <li>Delete your data by clearing your browser's local storage</li>
            <li>Export your custom sets at any time</li>
          </ul>
          
          <h4>Changes to This Policy</h4>
          <p>We may update this privacy policy from time to time. Any changes will be reflected in the app.</p>
          
          <h4>Contact</h4>
          <p>If you have any questions about this privacy policy, please visit: <a href="https://sisco-ask.vercel.app" target="_blank" rel="noopener noreferrer" style="color: #8b5cf6; font-weight: 700;">sisco-ask.vercel.app</a></p>
        `;
      }

      panel.classList.add('show');
    }

    // ========================================
    // FEEDBACK
    // ========================================

    function sendFeedback() {
      const feedback = document.getElementById('feedbackText').value.trim();
      
      if (feedbackRating === 0) {
        showToast('Please rate the app first', 'error');
        return;
      }
      
      if (!feedback) {
        showToast('Please write your feedback', 'error');
        return;
      }

      const message = `Rating and Feedback\n\nApp Name: ConnectEd\n\nRating: ${feedbackRating}/7 🌕\n\nFeedback: ${feedback}`;
      
      const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
      
      document.getElementById('feedbackModal').classList.remove('show');
      showToast('Thank you for your feedback!', 'success');
    }

    // ========================================
    // MASTER KEY
    // ========================================

    function loadMasterKey() {
      const savedKey = localStorage.getItem('hasMasterKey');
      if (savedKey === 'true') {
        hasMasterKey = true;
        unlockAllContent();
      }
    }

    async function saveMasterKey() {
      const key = document.getElementById('masterKeySettingsInput').value.trim();
      
      if (key === MASTER_KEY) {
        hasMasterKey = true;
        localStorage.setItem('hasMasterKey', 'true');
        await updateUserData({ has_master_key: true });
        unlockAllContent();
        document.getElementById('masterKeyModal').classList.remove('show');
        showToast('Master key activated! All content unlocked!', 'success');
      } else {
        showToast('Incorrect master key', 'error');
      }
    }

    function unlockAllContent() {
      // Unlock all game modes
      unlockedModes = GAME_MODES.map(mode => mode.id);
      renderGameModes();
    }

    // ========================================
    // NAVIGATION
    // ========================================

    function navigateToPage(pageName) {
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });

      document.getElementById(pageName + 'Page').classList.add('active');

      document.querySelectorAll('.nav-item, .bottom-nav-item').forEach(item => {
        item.classList.remove('active');
      });

      document.querySelectorAll(`[data-page="${pageName}"]`).forEach(item => {
        item.classList.add('active');
      });

      if (pageName === 'play') {
        showMatchTypeSelection();
      } else if (pageName === 'profile') {
        updateProfilePage();
      } else if (pageName === 'create') {
        resetCreateForm();
      }
    }

    function showMatchTypeSelection() {
      document.getElementById('matchTypeSelection').style.display = 'block';
      document.getElementById('subjectSelection').style.display = 'none';
      document.getElementById('setSelection').style.display = 'none';
    }

    function showSubjectSelection(matchType) {
      selectedMatchType = matchType;
      const matchTypeData = MATCH_TYPES[matchType];
      
      document.getElementById('matchTypeSelection').style.display = 'none';
      document.getElementById('subjectSelection').style.display = 'block';
      document.getElementById('setSelection').style.display = 'none';
      
      document.getElementById('currentMatchTypeBreadcrumb').textContent = matchTypeData.name;
      
      const subjectGrid = document.getElementById('subjectGrid');
      subjectGrid.innerHTML = '';
      
      Object.keys(matchTypeData.subjects).forEach(subject => {
        const sets = matchTypeData.subjects[subject];
        
        const subjectCard = document.createElement('div');
        subjectCard.className = 'subject-card';
        subjectCard.innerHTML = `
          <div class="subject-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" width="28" height="28">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <path d="M3 9h18M9 3v18"/>
            </svg>
          </div>
          <h3 class="subject-name">${subject}</h3>
          <p class="subject-info">${sets.length} sets available</p>
        `;
        subjectCard.addEventListener('click', () => showSetSelection(subject));
        subjectGrid.appendChild(subjectCard);
      });

      // Add custom sets
      const userCustomSets = customSets.filter(cs => cs.match_type === matchType);
      if (userCustomSets.length > 0) {
        const customSubjectCard = document.createElement('div');
        customSubjectCard.className = 'subject-card';
        customSubjectCard.innerHTML = `
          <div class="subject-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" width="28" height="28">
              <path d="M12 5v14M5 12h14"></path>
            </svg>
          </div>
          <h3 class="subject-name">My Custom Sets</h3>
          <p class="subject-info">${userCustomSets.length} sets available</p>
        `;
        customSubjectCard.addEventListener('click', () => showSetSelection('Custom'));
        subjectGrid.appendChild(customSubjectCard);
      }
    }

    function showSetSelection(subject) {
      selectedSubject = subject;
      const matchTypeData = MATCH_TYPES[selectedMatchType];
      
      document.getElementById('subjectSelection').style.display = 'none';
      document.getElementById('setSelection').style.display = 'block';
      document.getElementById('currentSubjectBreadcrumb').textContent = subject;
      
      const setList = document.getElementById('setList');
      setList.innerHTML = '';
      
      let sets = [];
      if (subject === 'Custom') {
        sets = customSets.filter(cs => cs.match_type === selectedMatchType);
      } else {
        sets = matchTypeData.subjects[subject] || [];
      }
      
      sets.forEach((set) => {
        const userBestScores = allGameData.filter(game => game.set_id === set.id);
        const stars = userBestScores.length > 0 ? '⭐⭐⭐' : '';
        
        const setItem = document.createElement('div');
        setItem.className = 'set-item';
        setItem.innerHTML = `
          <div class="set-main-info">
            <div class="set-name">
              ${set.name}
              <span class="difficulty-badge ${set.difficulty}">${set.difficulty}</span>
            </div>
            <p class="set-meta">${set.pairs.length} pairs</p>
          </div>
          <div class="set-stats">${stars}</div>
        `;
        
        setItem.addEventListener('click', () => {
          selectedSet = set;
          startGame();
        });
        
        setList.appendChild(setItem);
      });
    }

    // ========================================
    // RENDER FUNCTIONS
    // ========================================

    function renderMatchTypes() {
      const grid = document.getElementById('matchTypesGrid');
      grid.innerHTML = '';

      Object.keys(MATCH_TYPES).forEach(typeKey => {
        const type = MATCH_TYPES[typeKey];
        const totalSets = Object.values(type.subjects).reduce((sum, subj) => sum + subj.length, 0);

        const card = document.createElement('div');
        card.className = `match-type-card ${typeKey}`;
        card.innerHTML = `
          <div class="match-type-icon-wrapper">
            <span style="font-size: 32px">${type.icon}</span>
          </div>
          <h3 class="match-type-title">${type.name}</h3>
          <p class="match-type-description">Match ${typeKey === 'vocabulary' ? 'terms with definitions' : typeKey === 'image' ? 'images with descriptions' : typeKey === 'audio' ? 'sounds with names' : typeKey === 'concept' ? 'concepts with explanations' : typeKey === 'sequence' ? 'patterns with descriptions' : 'code with meanings'}</p>
          <div class="match-type-stats">${totalSets} Sets Available</div>
        `;
        card.addEventListener('click', () => showSubjectSelection(typeKey));
        grid.appendChild(card);
      });
    }

    function renderGameModes() {
      const container = document.getElementById('modeOptions');
      if (!container) return;

      container.innerHTML = '';
      
      GAME_MODES.forEach(mode => {
        const isUnlocked = hasMasterKey || unlockedModes.includes(mode.id);
        const option = document.createElement('div');
        option.className = `mode-option ${mode.id === selectedMode ? 'active' : ''} ${!isUnlocked && mode.locked ? 'locked' : ''}`;
        option.dataset.mode = mode.id;
        
        option.innerHTML = `
          ${!isUnlocked && mode.locked ? '<span class="lock-icon">🔒</span>' : ''}
          <p class="mode-option-name">${mode.name}</p>
          <p class="mode-option-desc">${mode.description}</p>
        `;
        
        option.addEventListener('click', () => {
          if (!isUnlocked && mode.locked) {
            selectedModeForUnlock = mode;
            const gamesNeeded = mode.requiredGames - allGameData.length;
            document.getElementById('unlockMessage').textContent = 
              gamesNeeded > 0 
                ? `Complete ${gamesNeeded} more game${gamesNeeded > 1 ? 's' : ''} or enter the master key to unlock this mode.`
                : 'Enter the master key to unlock this mode.';
            document.getElementById('unlockModal').classList.add('show');
            document.getElementById('masterKeyInput').value = '';
          } else {
            document.querySelectorAll('.mode-option').forEach(opt => {
              opt.classList.remove('active');
            });
            option.classList.add('active');
            selectedMode = mode.id;
          }
        });
        
        container.appendChild(option);
      });
    }

    function renderAchievements() {
      const grid = document.getElementById('achievementsGrid');
      if (!grid) return;

      grid.innerHTML = '';
      
      ACHIEVEMENTS.forEach(achievement => {
        const isUnlocked = userAchievements.includes(achievement.id);
        
        const card = document.createElement('div');
        card.className = `achievement-card ${isUnlocked ? 'unlocked' : 'locked'}`;
        card.innerHTML = `
          <div class="achievement-icon">${achievement.icon}</div>
          <h4 class="achievement-name">${achievement.name}</h4>
          <p class="achievement-desc">${achievement.description}</p>
        `;
        
        grid.appendChild(card);
      });
    }

    // ========================================
    // GAME LOGIC
    // ========================================

    function startGame() {
      navigateToPage('game');
      initializeGame();
    }

    function initializeGame() {
      // Clear any existing timer
      if (gameState.timerInterval) {
        clearInterval(gameState.timerInterval);
      }

      // Reset game state
      gameState = {
        selectedTerm: null,
        selectedDefinition: null,
        matchedPairs: [],
        wrongAttempts: 0,
        hintsUsed: 0,
        startTime: Date.now(),
        timerInterval: null,
        timeElapsed: 0,
        strikes: 0
      };

      // Show matching area, hide results
      document.getElementById('matchingArea').style.display = 'grid';
      document.getElementById('gameResults').classList.remove('show');
      
      // Reset hint button
      document.getElementById('hintBtn').disabled = false;
      
      // Update UI
      document.getElementById('gameSetName').textContent = selectedSet.name;
      document.getElementById('gameModeBadge').textContent = getModeDisplayName(selectedMode);
      document.getElementById('matchesCount').textContent = '0';
      document.getElementById('totalPairs').textContent = selectedSet.pairs.length;
      document.getElementById('hintsUsed').textContent = '0';
      
      // Reset timer
      document.getElementById('gameTimer').textContent = '00:00';
      
      // Start timer
      startGameTimer();

      // Render cards
      renderMatchCards();
    }

    function renderMatchCards() {
      const termsColumn = document.getElementById('termsColumn');
      const definitionsColumn = document.getElementById('definitionsColumn');
      
      termsColumn.innerHTML = '';
      definitionsColumn.innerHTML = '';

      const shuffledTerms = [...selectedSet.pairs].sort(() => Math.random() - 0.5);
      const shuffledDefs = [...selectedSet.pairs].sort(() => Math.random() - 0.5);

      shuffledTerms.forEach((pair) => {
        const termCard = document.createElement('div');
        termCard.className = 'match-card';
        termCard.dataset.id = pair.term;
        termCard.innerHTML = `
          <span class="match-card-text">${pair.term}</span>
          <div class="check-mark">
            <svg viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </div>
        `;
        termCard.addEventListener('click', () => selectCard('term', pair.term, termCard));
        termsColumn.appendChild(termCard);
      });

      shuffledDefs.forEach((pair) => {
        const defCard = document.createElement('div');
        defCard.className = 'match-card';
        defCard.dataset.id = pair.definition;
        defCard.innerHTML = `
          <span class="match-card-text">${pair.definition}</span>
          <div class="check-mark">
            <svg viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </div>
        `;
        defCard.addEventListener('click', () => selectCard('definition', pair.definition, defCard));
        definitionsColumn.appendChild(defCard);
      });
    }

    function selectCard(type, id, cardElement) {
      if (cardElement.classList.contains('matched')) return;

      if (type === 'term') {
        if (gameState.selectedTerm && gameState.selectedTerm !== id) {
          document.querySelectorAll('.match-card').forEach(card => {
            if (card.dataset.id === gameState.selectedTerm) {
              card.classList.remove('selected');
            }
          });
        }

        if (gameState.selectedTerm === id) {
          gameState.selectedTerm = null;
          cardElement.classList.remove('selected');
        } else {
          gameState.selectedTerm = id;
          cardElement.classList.add('selected');
        }
      } else {
        if (gameState.selectedDefinition && gameState.selectedDefinition !== id) {
          document.querySelectorAll('.match-card').forEach(card => {
            if (card.dataset.id === gameState.selectedDefinition) {
              card.classList.remove('selected');
            }
          });
        }

        if (gameState.selectedDefinition === id) {
          gameState.selectedDefinition = null;
          cardElement.classList.remove('selected');
        } else {
          gameState.selectedDefinition = id;
          cardElement.classList.add('selected');
        }
      }

      if (gameState.selectedTerm && gameState.selectedDefinition) {
        checkMatch();
      }
    }

    function checkMatch() {
      const matchedPair = selectedSet.pairs.find(
        pair => pair.term === gameState.selectedTerm && pair.definition === gameState.selectedDefinition
      );

      if (matchedPair) {
        gameState.matchedPairs.push(matchedPair);

        document.querySelectorAll('.match-card').forEach(card => {
          if (card.dataset.id === gameState.selectedTerm || card.dataset.id === gameState.selectedDefinition) {
            card.classList.remove('selected');
            card.classList.add('matched');
          }
        });

        gameState.selectedTerm = null;
        gameState.selectedDefinition = null;

        document.getElementById('matchesCount').textContent = gameState.matchedPairs.length;

        if (gameState.matchedPairs.length === selectedSet.pairs.length) {
          setTimeout(() => endGame(true), 500);
        }
      } else {
        gameState.wrongAttempts++;
        gameState.strikes++;

        document.querySelectorAll('.match-card').forEach(card => {
          if (card.dataset.id === gameState.selectedTerm || card.dataset.id === gameState.selectedDefinition) {
            card.classList.remove('selected');
          }
        });

        gameState.selectedTerm = null;
        gameState.selectedDefinition = null;

        // Check elimination mode
        if (selectedMode === 'elimination' && gameState.strikes >= 3) {
          setTimeout(() => endGame(false), 300);
        }
      }
    }

    function showHint() {
      if (gameState.hintsUsed >= 3) {
        showToast('No more hints available!', 'error');
        return;
      }

      const unmatchedPairs = selectedSet.pairs.filter(
        pair => !gameState.matchedPairs.includes(pair)
      );

      if (unmatchedPairs.length === 0) return;

      const hintPair = unmatchedPairs[0];

      document.querySelectorAll('.match-card').forEach(card => {
        if (card.dataset.id === hintPair.term || card.dataset.id === hintPair.definition) {
          card.style.border = '3px solid #fbbf24';
          setTimeout(() => {
            card.style.border = '';
          }, 2000);
        }
      });

      gameState.hintsUsed++;
      document.getElementById('hintsUsed').textContent = gameState.hintsUsed;

      if (gameState.hintsUsed >= 3) {
        document.getElementById('hintBtn').disabled = true;
      }
    }

    function startGameTimer() {
      gameState.timerInterval = setInterval(() => {
        gameState.timeElapsed++;
        updateTimerDisplay();

        // Check time limits
        if (selectedMode === 'speed' && gameState.timeElapsed >= 60) {
          endGame(false);
        } else if (selectedMode === 'time_attack' && gameState.timeElapsed >= 45) {
          endGame(false);
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const minutes = Math.floor(gameState.timeElapsed / 60);
      const seconds = gameState.timeElapsed % 60;
      const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      document.getElementById('gameTimer').textContent = display;
    }

    async function endGame(completed) {
      if (gameState.timerInterval) {
        clearInterval(gameState.timerInterval);
      }

      const totalTime = gameState.timeElapsed;
      const totalAttempts = gameState.matchedPairs.length + gameState.wrongAttempts;
      const accuracy = totalAttempts > 0 ? Math.round((gameState.matchedPairs.length / totalAttempts) * 100) : 0;
      
      let score = 0;
      if (completed) {
        score = 100;
        
        if (totalTime <= 30) score += 100;
        else if (totalTime <= 45) score += 75;
        else if (totalTime <= 60) score += 50;
        
        score += Math.floor(accuracy / 2);
        score -= gameState.hintsUsed * 10;
        score -= gameState.wrongAttempts * 5;
        score = Math.max(0, score);
      }

      if (window.dataSdk && completed) {
        const gameRecord = {
          type: 'game',
          set_id: selectedSet.id,
          set_name: selectedSet.name,
          match_type: selectedMatchType,
          subject: selectedSubject,
          mode: selectedMode,
          score: score,
          time: totalTime,
          accuracy: accuracy,
          hints_used: gameState.hintsUsed,
          wrong_attempts: gameState.wrongAttempts,
          completed: completed,
          timestamp: new Date().toISOString()
        };

        await window.dataSdk.create(gameRecord);
        
        // Check for new achievements
        await checkAndUnlockAchievements(score, totalTime, accuracy);
      }

      const stars = score >= 250 ? 3 : score >= 150 ? 2 : score >= 50 ? 1 : 0;
      document.getElementById('resultsTitle').textContent = completed ? 
        (stars === 3 ? 'Excellent!' : stars === 2 ? 'Great Job!' : 'Well Done!') : 
        (selectedMode === 'elimination' ? 'Out of Strikes!' : 'Time Up!');
      
      document.getElementById('resultsStars').textContent = '⭐'.repeat(stars);
      
      const minutes = Math.floor(totalTime / 60);
      const seconds = totalTime % 60;
      document.getElementById('resultTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      document.getElementById('resultAccuracy').textContent = `${accuracy}%`;
      document.getElementById('resultScore').textContent = score;

      document.getElementById('matchingArea').style.display = 'none';
      document.getElementById('gameResults').classList.add('show');
    }

    function getModeDisplayName(mode) {
      const modeObj = GAME_MODES.find(m => m.id === mode);
      return modeObj ? modeObj.name : 'Classic Mode';
    }

    // ========================================
    // ACHIEVEMENTS
    // ========================================

    async function checkAndUnlockAchievements(score, time, accuracy) {
      const newAchievements = [];

      // First Victory
      if (allGameData.length === 1 && !userAchievements.includes('first_win')) {
        newAchievements.push('first_win');
      }

      // Speed Demon
      if (time <= 30 && !userAchievements.includes('speed_demon')) {
        newAchievements.push('speed_demon');
      }

      // Perfect Game
      if (accuracy === 100 && !userAchievements.includes('perfect_game')) {
        newAchievements.push('perfect_game');
      }

      // Master Mind
      if (gameState.hintsUsed === 0 && !userAchievements.includes('no_hints')) {
        newAchievements.push('no_hints');
      }

      // Dedicated Learner
      if (allGameData.length >= 10 && !userAchievements.includes('ten_games')) {
        newAchievements.push('ten_games');
      }

      // Century Club
      if (score >= 100 && !userAchievements.includes('hundred_points')) {
        newAchievements.push('hundred_points');
      }

      if (newAchievements.length > 0) {
        await updateUserData({ achievements: [...userAchievements, ...newAchievements] });
        
        newAchievements.forEach(achId => {
          const ach = ACHIEVEMENTS.find(a => a.id === achId);
          if (ach) {
            showToast(`Achievement Unlocked: ${ach.name} ${ach.icon}`, 'success');
          }
        });
      }
    }

    function checkAchievements() {
      // Subject Master
      if (!userAchievements.includes('all_subjects')) {
        const uniqueTypes = [...new Set(allGameData.map(g => g.match_type))];
        if (uniqueTypes.length >= 4) {
          updateUserData({ achievements: [...userAchievements, 'all_subjects'] });
        }
      }
    }

    // ========================================
    // CREATE SET
    // ========================================

    let pairCount = 1;

    function resetCreateForm() {
      document.getElementById('setName').value = '';
      document.getElementById('setSubject').value = '';
      document.getElementById('setDifficulty').value = 'beginner';
      
      const container = document.getElementById('pairsContainer');
      container.innerHTML = `
        <div class="pair-item" data-pair-index="0">
          <div class="pair-number">Pair 1</div>
          <div class="form-group">
            <label class="form-label">Term</label>
            <input type="text" class="form-input pair-term" placeholder="Enter term" />
          </div>
          <div class="form-group">
            <label class="form-label">Definition</label>
            <input type="text" class="form-input pair-definition" placeholder="Enter definition" />
          </div>
        </div>
      `;
      pairCount = 1;
    }

    function addPairField() {
      const container = document.getElementById('pairsContainer');
      pairCount++;
      
      const pairItem = document.createElement('div');
      pairItem.className = 'pair-item';
      pairItem.dataset.pairIndex = pairCount - 1;
      pairItem.innerHTML = `
        <div class="pair-number">Pair ${pairCount}</div>
        <button class="remove-pair-btn" onclick="removePair(${pairCount - 1})">×</button>
        <div class="form-group">
          <label class="form-label">Term</label>
          <input type="text" class="form-input pair-term" placeholder="Enter term" />
        </div>
        <div class="form-group">
          <label class="form-label">Definition</label>
          <input type="text" class="form-input pair-definition" placeholder="Enter definition" />
        </div>
      `;
      
      container.appendChild(pairItem);
    }

    window.removePair = function(index) {
      const item = document.querySelector(`[data-pair-index="${index}"]`);
      if (item) {
        item.remove();
        pairCount--;
      }
    };

    async function saveCustomSet() {
      const name = document.getElementById('setName').value.trim();
      const subject = document.getElementById('setSubject').value.trim();
      const difficulty = document.getElementById('setDifficulty').value;

      if (!name || !subject) {
        showToast('Please fill in set name and subject', 'error');
        return;
      }

      const pairs = [];
      const pairItems = document.querySelectorAll('.pair-item');
      
      pairItems.forEach(item => {
        const term = item.querySelector('.pair-term').value.trim();
        const definition = item.querySelector('.pair-definition').value.trim();
        
        if (term && definition) {
          pairs.push({ term, definition });
        }
      });

      if (pairs.length < 4) {
        showToast('Please create at least 4 pairs', 'error');
        return;
      }

      if (window.dataSdk) {
        const customSet = {
          type: 'custom_set',
          id: 'custom-' + Date.now(),
          name: name,
          subject: subject,
          match_type: 'vocabulary',
          difficulty: difficulty,
          pairs: pairs,
          created_at: new Date().toISOString()
        };

        const result = await window.dataSdk.create(customSet);
        
        if (result.isOk) {
          showToast('Custom set created successfully!', 'success');
          
          // Check achievement
          if (!userAchievements.includes('custom_creator')) {
            await updateUserData({ achievements: [...userAchievements, 'custom_creator'] });
            showToast('Achievement Unlocked: Set Creator ✨', 'success');
          }
          
          setTimeout(() => {
            navigateToPage('play');
          }, 1500);
        } else {
          showToast('Failed to create set', 'error');
        }
      }
    }

    // ========================================
    // PROFILE
    // ========================================

    function updateProfilePage() {
      document.getElementById('profileName').textContent = currentUsername;
      document.getElementById('profileAvatar').textContent = currentUsername.charAt(0).toUpperCase();
      
      const level = Math.floor(allGameData.length / 5) + 1;
      document.getElementById('profileLevel').textContent = level;

      // Detailed stats
      document.getElementById('totalGamesPlayed').textContent = allGameData.length;
      
      const totalScore = allGameData.reduce((sum, game) => sum + (game.score || 0), 0);
      document.getElementById('totalScore').textContent = totalScore;
      
      const avgAccuracy = allGameData.length > 0 
        ? Math.round(allGameData.reduce((sum, game) => sum + game.accuracy, 0) / allGameData.length)
        : 0;
      document.getElementById('avgAccuracy').textContent = `${avgAccuracy}%`;
      
      const fastestGame = allGameData.reduce((min, game) => 
        game.time < min ? game.time : min, Infinity);
      if (fastestGame !== Infinity) {
        const mins = Math.floor(fastestGame / 60);
        const secs = fastestGame % 60;
        document.getElementById('fastestTime').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
      }
      
      const perfectGames = allGameData.filter(game => game.accuracy === 100).length;
      document.getElementById('perfectGames').textContent = perfectGames;
      
      document.getElementById('customSetsCreated').textContent = customSets.length;

      renderAchievements();
    }

    // ========================================
    // SETTINGS
    // ========================================

    function loadSettings() {
      const savedDarkMode = localStorage.getItem('darkMode');
      if (savedDarkMode === 'true') {
        settings.darkMode = true;
        document.body.classList.add('dark-mode');
        document.getElementById('darkModeToggle').classList.add('active');
      }
    }

    function toggleDarkMode() {
      settings.darkMode = !settings.darkMode;
      document.body.classList.toggle('dark-mode');
      document.getElementById('darkModeToggle').classList.toggle('active');
      localStorage.setItem('darkMode', settings.darkMode);
    }

    function loadUsername() {
      const savedUsername = localStorage.getItem('username');
      if (savedUsername) {
        currentUsername = savedUsername;
        document.getElementById('usernameDisplay').textContent = currentUsername;
        document.getElementById('currentUsername').textContent = currentUsername;
      }
    }

    function saveUsername() {
      const newUsername = document.getElementById('usernameInput').value.trim();
      if (newUsername) {
        currentUsername = newUsername;
        localStorage.setItem('username', currentUsername);
        document.getElementById('usernameDisplay').textContent = currentUsername;
        document.getElementById('currentUsername').textContent = currentUsername;
        document.getElementById('profileName').textContent = currentUsername;
        document.getElementById('profileAvatar').textContent = currentUsername.charAt(0).toUpperCase();
        document.getElementById('usernameModal').classList.remove('show');
        
        updateUserData({ username: currentUsername });
        showToast('Username updated!', 'success');
      }
    }

    // ========================================
    // UNLOCK MODES
    // ========================================

    function handleUnlock() {
      const key = document.getElementById('masterKeyInput').value.trim();
      
      if (key === MASTER_KEY) {
        if (selectedModeForUnlock) {
          unlockedModes.push(selectedModeForUnlock.id);
          updateUserData({ unlocked_modes: unlockedModes });
          renderGameModes();
          showToast(`${selectedModeForUnlock.name} unlocked!`, 'success');
          document.getElementById('unlockModal').classList.remove('show');
        }
      } else {
        showToast('Incorrect master key', 'error');
      }
    }

    // ========================================
    // STATS
    // ========================================

    function updateAllStats() {
      const totalGames = allGameData.length;
      const accuracy = allGameData.length > 0 ? 
        Math.round(allGameData.reduce((sum, game) => sum + game.accuracy, 0) / allGameData.length) : 0;
      const level = Math.floor(allGameData.length / 5) + 1;

      document.getElementById('totalMatchesStat').textContent = totalGames;
      document.getElementById('winStreakStat').textContent = 0;
      document.getElementById('accuracyStat').textContent = `${accuracy}%`;
      document.getElementById('levelStat').textContent = level;

      // Check for mode unlocks based on games played
      GAME_MODES.forEach(mode => {
        if (mode.locked && !unlockedModes.includes(mode.id) && allGameData.length >= mode.requiredGames) {
          // Auto-unlock when requirement met (but they still need master key for manual unlock)
        }
      });
    }

    async function updateUserData(updates) {
      // Check if user data exists
      const existingUserData = allGameData.find(item => item.type === 'user_data');
      
      if (existingUserData) {
        // Update existing
        const updated = { ...existingUserData, ...updates };
        if (window.dataSdk) {
          await window.dataSdk.update(updated);
        }
      } else {
        // Create new
        if (window.dataSdk) {
          await window.dataSdk.create({
            type: 'user_data',
            username: currentUsername,
            achievements: userAchievements,
            unlocked_modes: unlockedModes,
            has_master_key: hasMasterKey,
            ...updates
          });
        }
      }
    }

    // ========================================
    // UTILITY
    // ========================================

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast show ' + type;
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // ========================================
    // INITIALIZE
    // ========================================

    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a4c5a497108d622',t:'MTc2NDE5MTIxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>